!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("htmlmixed",function(t,i){function u(e,t){var i=t.htmlState.tagName;i&&(i=i.toLowerCase());var o=r.token(e,t.htmlState);if("script"==i&&/\btag\b/.test(o)&&">"==e.current()){var s=e.string.slice(Math.max(0,e.pos-100),e.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);s=s?s[1]:"",s&&/[\"\']/.test(s.charAt(0))&&(s=s.slice(1,s.length-1));for(var l=0;l<a.length;++l){var u=a[l];if("string"==typeof u.matches?s==u.matches:u.matches.test(s)){u.mode&&(t.token=f,t.localMode=u.mode,t.localState=u.mode.startState&&u.mode.startState(r.indent(t.htmlState,"")));break}}}else"style"==i&&/\btag\b/.test(o)&&">"==e.current()&&(t.token=d,t.localMode=n,t.localState=n.startState(r.indent(t.htmlState,"")));return o}function c(e,t,i){var a,r=e.current(),n=r.search(t);return n>-1?e.backUp(r.length-n):(a=r.match(/<\/?$/))&&(e.backUp(r.length),e.match(t,!1)||e.match(r)),i}function f(e,t){return e.match(/^<\/\s*script\s*>/i,!1)?(t.token=u,t.localState=t.localMode=null,u(e,t)):c(e,/<\/\s*script\s*>/,t.localMode.token(e,t.localState))}function d(e,t){return e.match(/^<\/\s*style\s*>/i,!1)?(t.token=u,t.localState=t.localMode=null,u(e,t)):c(e,/<\/\s*style\s*>/,n.token(e,t.localState))}var r=e.getMode(t,{name:"xml",htmlMode:!0,multilineTagIndentFactor:i.multilineTagIndentFactor,multilineTagIndentPastTag:i.multilineTagIndentPastTag}),n=e.getMode(t,"css"),a=[],o=i&&i.scriptTypes;if(a.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:e.getMode(t,"javascript")}),o)for(var s=0;s<o.length;++s){var l=o[s];a.push({matches:l.matches,mode:l.mode&&e.getMode(t,l.mode)})}return a.push({matches:/./,mode:e.getMode(t,"text/plain")}),{startState:function(){var e=r.startState();return{token:u,localMode:null,localState:null,htmlState:e}},copyState:function(t){if(t.localState)var i=e.copyState(t.localMode,t.localState);return{token:t.token,localMode:t.localMode,localState:i,htmlState:e.copyState(r,t.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(t,i){return!t.localMode||/^\s*<\//.test(i)?r.indent(t.htmlState,i):t.localMode.indent?t.localMode.indent(t.localState,i):e.Pass},innerMode:function(e){return{state:e.localState||e.htmlState,mode:e.localMode||r}}}},"xml","javascript","css"),e.defineMIME("text/html","htmlmixed")});
