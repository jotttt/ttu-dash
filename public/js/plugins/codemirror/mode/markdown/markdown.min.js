!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror",require("../xml/xml"))):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("markdown",function(t,r){function N(e,t,r){return t.f=t.inline=r,r(e,t)}function A(e,t,r){return t.f=t.block=r,r(e,t)}function M(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.quote=0,i||e.f!=I||(e.f=P,e.block=O),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.thisLineHasContent=!1,null}function O(e,t){var i=e.sol(),n=t.list!==!1;t.list!==!1&&t.indentationDiff>=0?(t.indentationDiff<4&&(t.indentation-=t.indentationDiff),t.list=null):t.list!==!1&&t.indentation>0?(t.list=null,t.listDepth=Math.floor(t.indentation/4)):t.list!==!1&&(t.list=!1,t.listDepth=0);var a=null;if(t.indentationDiff>=4)return t.indentation-=4,e.skipToEnd(),u;if(e.eatSpace())return null;if(a=e.match(C))return t.header=a[0].length<=6?a[0].length:6,r.highlightFormatting&&(t.formatting="header"),t.f=t.inline,L(t);if(t.prevLineHasContent&&(a=e.match(_)))return t.header="="==a[0].charAt(0)?1:2,r.highlightFormatting&&(t.formatting="header"),t.f=t.inline,L(t);if(e.eat(">"))return t.indentation++,t.quote=i?1:t.quote+1,r.highlightFormatting&&(t.formatting="quote"),e.eatSpace(),L(t);if("["===e.peek())return N(e,t,z);if(e.match(k,!0))return p;if((!t.prevLineHasContent||n)&&(e.match(Q,!1)||e.match(T,!1))){var s=null;return e.match(Q,!0)?s="ul":(e.match(T,!0),s="ol"),t.indentation+=4,t.list=!0,t.listDepth++,r.taskLists&&e.match(S,!1)&&(t.taskList=!0),t.f=t.inline,r.highlightFormatting&&(t.formatting=["list","list-"+s]),L(t)}return r.fencedCodeBlocks&&e.match(/^```([\w+#]*)/,!0)?(t.localMode=o(RegExp.$1),t.localMode&&(t.localState=t.localMode.startState()),A(e,t,D),r.highlightFormatting&&(t.formatting="code-block"),t.code=!0,L(t)):N(e,t,t.inline)}function I(e,t){var r=n.token(e,t.htmlState);return(i&&null===t.htmlState.tagStart&&!t.htmlState.context||t.md_inside&&e.current().indexOf(">")>-1)&&(t.f=P,t.block=O,t.htmlState=null),r}function D(e,t){if(e.sol()&&e.match(/^```/,!0)){t.localMode=t.localState=null,t.f=P,t.block=O,r.highlightFormatting&&(t.formatting="code-block"),t.code=!0;var i=L(t);return t.code=!1,i}return t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),u)}function L(e){var t=[];if(e.formatting){t.push(y),"string"==typeof e.formatting&&(e.formatting=[e.formatting]);for(var i=0;i<e.formatting.length;i++)t.push(y+"-"+e.formatting[i]),"header"===e.formatting[i]&&t.push(y+"-"+e.formatting[i]+"-"+e.header),"quote"===e.formatting[i]&&(!r.maxBlockquoteDepth||r.maxBlockquoteDepth>=e.quote?t.push(y+"-"+e.formatting[i]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref)return t.push(w),t.length?t.join(" "):null;if(e.strong&&t.push(j),e.em&&t.push(x),e.linkText&&t.push(b),e.code&&t.push(u),e.header&&(t.push(l),t.push(l+"-"+e.header)),e.quote&&(t.push(c),!r.maxBlockquoteDepth||r.maxBlockquoteDepth>=e.quote?t.push(c+"-"+e.quote):t.push(c+"-"+r.maxBlockquoteDepth)),e.list!==!1){var n=(e.listDepth-1)%3;n?1===n?t.push(d):t.push(h):t.push(f)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function $(e,t){return e.match(E,!0)?L(t):void 0}function P(t,i){var a=i.text(t,i);if("undefined"!=typeof a)return a;if(i.list)return i.list=null,L(i);if(i.taskList){var o="x"!==t.match(S,!0)[1];return o?i.taskOpen=!0:i.taskClosed=!0,r.highlightFormatting&&(i.formatting="task"),i.taskList=!1,L(i)}if(i.taskOpen=!1,i.taskClosed=!1,i.header&&t.match(/^#+$/,!0))return r.highlightFormatting&&(i.formatting="header"),L(i);var l=t.sol(),u=t.next();if("\\"===u&&(t.next(),r.highlightFormatting)){var c=L(i);return c?c+" formatting-escape":"formatting-escape"}if(i.linkTitle){i.linkTitle=!1;var f=u;"("===u&&(f=")"),f=(f+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var d="^\\s*(?:[^"+f+"\\\\]+|\\\\\\\\|\\\\.)"+f;if(t.match(new RegExp(d),!0))return w}if("`"===u){var h=i.formatting;r.highlightFormatting&&(i.formatting="code");var p=L(i),y=t.pos;t.eatWhile("`");var b=1+t.pos-y;return i.code?b===s?(i.code=!1,p):(i.formatting=h,L(i)):(s=b,i.code=!0,L(i))}if(i.code)return L(i);if("!"===u&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return t.match(/\[[^\]]*\]/),i.inline=i.f=F,m;if("["===u&&t.match(/.*\](\(| ?\[)/,!1))return i.linkText=!0,r.highlightFormatting&&(i.formatting="link"),L(i);if("]"===u&&i.linkText){r.highlightFormatting&&(i.formatting="link");var c=L(i);return i.linkText=!1,i.inline=i.f=F,c}if("<"===u&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=R,r.highlightFormatting&&(i.formatting="link");var c=L(i);return c?c+=" ":c="",c+g}if("<"===u&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=R,r.highlightFormatting&&(i.formatting="link");var c=L(i);return c?c+=" ":c="",c+v}if("<"===u&&t.match(/^\w/,!1)){if(-1!=t.string.indexOf(">")){var x=t.string.substring(1,t.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(x)&&(i.md_inside=!0)}return t.backUp(1),i.htmlState=e.startState(n),A(t,i,I)}if("<"===u&&t.match(/^\/\w*?>/))return i.md_inside=!1,"tag";var j=!1;if(!r.underscoresBreakWords&&"_"===u&&"_"!==t.peek()&&t.match(/(\w)/,!1)){var k=t.pos-2;if(k>=0){var Q=t.string.charAt(k);"_"!==Q&&Q.match(/(\w)/,!1)&&(j=!0)}}if("*"===u||"_"===u&&!j)if(l&&" "===t.peek());else{if(i.strong===u&&t.eat(u)){r.highlightFormatting&&(i.formatting="strong");var p=L(i);return i.strong=!1,p}if(!i.strong&&t.eat(u))return i.strong=u,r.highlightFormatting&&(i.formatting="strong"),L(i);if(i.em===u){r.highlightFormatting&&(i.formatting="em");var p=L(i);return i.em=!1,p}if(!i.em)return i.em=u,r.highlightFormatting&&(i.formatting="em"),L(i)}else if(" "===u&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return L(i);t.backUp(1)}return" "===u&&(t.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),L(i)}function R(e,t){var i=e.next();if(">"===i){t.f=t.inline=P,r.highlightFormatting&&(t.formatting="link");var n=L(t);return n?n+=" ":n="",n+g}return e.match(/^[^>]+/,!0),g}function F(e,t){if(e.eatSpace())return null;var i=e.next();return"("===i||"["===i?(t.f=t.inline=q("("===i?")":"]"),r.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,L(t)):"error"}function q(e){return function(t,i){var n=t.next();if(n===e){i.f=i.inline=P,r.highlightFormatting&&(i.formatting="link-string");var a=L(i);return i.linkHref=!1,a}return t.match(U(e),!0)&&t.backUp(1),i.linkHref=!0,L(i)}}function z(e,t){return e.match(/^[^\]]*\]:/,!1)?(t.f=H,e.next(),r.highlightFormatting&&(t.formatting="link"),t.linkText=!0,L(t)):N(e,t,P)}function H(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=B,r.highlightFormatting&&(t.formatting="link");var i=L(t);return t.linkText=!1,i}return e.match(/^[^\]]+/,!0),b}function B(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),void 0===e.peek()?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=P,w)}function U(e){return W[e]||(e=(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),W[e]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+e+")")),W[e]}var i=e.modes.hasOwnProperty("xml"),n=e.getMode(t,i?{name:"xml",htmlMode:!0}:"text/plain"),a={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},o=function(){var r,o,i={},n={},s=[];for(var l in e.modes)e.modes.propertyIsEnumerable(l)&&s.push(l);for(r=0;r<s.length;r++)i[s[r]]=s[r];var u=[];for(var l in e.mimeModes)e.mimeModes.propertyIsEnumerable(l)&&u.push({mime:l,mode:e.mimeModes[l]});for(r=0;r<u.length;r++)o=u[r].mime,n[o]=u[r].mime;for(var c in a)(a[c]in i||a[c]in n)&&(i[c]=a[c]);return function(r){return i[r]?e.getMode(t,i[r]):null}}();void 0===r.highlightFormatting&&(r.highlightFormatting=!1),void 0===r.maxBlockquoteDepth&&(r.maxBlockquoteDepth=0),void 0===r.underscoresBreakWords&&(r.underscoresBreakWords=!0),void 0===r.fencedCodeBlocks&&(r.fencedCodeBlocks=!1),void 0===r.taskLists&&(r.taskLists=!1);var s=0,l="header",u="comment",c="quote",f="variable-2",d="variable-3",h="keyword",p="hr",m="tag",y="formatting",g="link",v="link",b="link",w="string",x="em",j="strong",k=/^([*\-=_])(?:\s*\1){2,}\s*$/,Q=/^[*\-+]\s+/,T=/^[0-9]+\.\s+/,S=/^\[(x| )\](?=\s)/,C=/^#+/,_=/^(?:\={1,}|-{1,})$/,E=/^[^#!\[\]*_\\<>` "'(]+/,W=[],V={startState:function(){return{f:O,prevLineHasContent:!1,thisLineHasContent:!1,block:O,htmlState:null,indentation:0,inline:P,text:$,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(t){return{f:t.f,prevLineHasContent:t.prevLineHasContent,thisLineHasContent:t.thisLineHasContent,block:t.block,htmlState:t.htmlState&&e.copyState(n,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,em:t.em,strong:t.strong,header:t.header,taskList:t.taskList,list:t.list,listDepth:t.listDepth,quote:t.quote,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside}},token:function(e,t){if(t.formatting=!1,e.sol()){var r=!!t.header;if(t.header=0,e.match(/^\s*$/,!0)||r)return t.prevLineHasContent=!1,M(t),r?this.token(e,t):null;t.prevLineHasContent=t.thisLineHasContent,t.thisLineHasContent=!0,t.taskList=!1,t.code=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var i=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,n=4*Math.floor((i-t.indentation)/4);n>4&&(n=4);var a=t.indentation+n;if(t.indentationDiff=a-t.indentation,t.indentation=a,i>0)return null}var o=t.f(e,t);return e.start==e.pos?this.token(e,t):o},innerMode:function(e){return e.block==I?{state:e.htmlState,mode:n}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:V}},blankLine:M,getType:L,fold:"markdown"};return V},"xml"),e.defineMIME("text/x-markdown","markdown")});
