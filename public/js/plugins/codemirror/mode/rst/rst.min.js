!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("rst",function(t,r){var i=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,n=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,a=/^``[^`\s](?:[^`]*[^`\s])``/,o=/^(?:[\d]+(?:[\.,]\d+)*)/,s=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,l=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,u="[Hh][Tt][Tt][Pp][Ss]?://",c="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",f="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",d=new RegExp("^"+u+c+f),p={token:function(e){if(e.match(i)&&e.match(/\W+|$/,!1))return"strong";if(e.match(n)&&e.match(/\W+|$/,!1))return"em";if(e.match(a)&&e.match(/\W+|$/,!1))return"string-2";if(e.match(o))return"number";if(e.match(s))return"positive";if(e.match(l))return"negative";if(e.match(d))return"link";for(;!(null==e.next()||e.match(i,!1)||e.match(n,!1)||e.match(a,!1)||e.match(o,!1)||e.match(s,!1)||e.match(l,!1)||e.match(d,!1)););return null}},h=e.getMode(t,r.backdrop||"rst-base");return e.overlayMode(h,p,!0)},"python","stex"),e.defineMode("rst-base",function(t){function r(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,r){return"undefined"!=typeof t[r]?t[r]:e})}function z(t,r){var a=null;if(t.sol()&&t.match(P,!1))G(r,W,{mode:i,local:e.startState(i)});else if(t.sol()&&t.match(y))G(r,F),a="meta";else if(t.sol()&&t.match(m))G(r,z),a="header";else if(Y(r)==Q||t.match(Q,!1))switch(X(r)){case 0:G(r,z,V(Q,1)),t.match(/^:/),a="meta";break;case 1:G(r,z,V(Q,2)),t.match(u),a="keyword",t.current().match(/^(?:math|latex)/)&&(r.tmp_stex=!0);break;case 2:G(r,z,V(Q,3)),t.match(/^:`/),a="meta";break;case 3:if(r.tmp_stex&&(r.tmp_stex=void 0,r.tmp={mode:n,local:e.startState(n)}),r.tmp){if("`"==t.peek()){G(r,z,V(Q,4)),r.tmp=void 0;break}a=r.tmp.mode.token(t,r.tmp.local);break}G(r,z,V(Q,4)),t.match(h),a="string";break;case 4:G(r,z,V(Q,5)),t.match(/^`/),a="meta";break;case 5:G(r,z,V(Q,6)),t.match(s);break;default:G(r,z)}else if(Y(r)==C||t.match(C,!1))switch(X(r)){case 0:G(r,z,V(C,1)),t.match(/^`/),a="meta";break;case 1:G(r,z,V(C,2)),t.match(h),a="string";break;case 2:G(r,z,V(C,3)),t.match(/^`:/),a="meta";break;case 3:G(r,z,V(C,4)),t.match(u),a="keyword";break;case 4:G(r,z,V(C,5)),t.match(/^:/),a="meta";break;case 5:G(r,z,V(C,6)),t.match(s);break;default:G(r,z)}else if(Y(r)==E||t.match(E,!1))switch(X(r)){case 0:G(r,z,V(E,1)),t.match(/^:/),a="meta";break;case 1:G(r,z,V(E,2)),t.match(u),a="keyword";break;case 2:G(r,z,V(E,3)),t.match(/^:/),a="meta";break;case 3:G(r,z,V(E,4)),t.match(s);break;default:G(r,z)}else if(Y(r)==k||t.match(k,!1))switch(X(r)){case 0:G(r,z,V(k,1)),t.match(A),a="variable-2";break;case 1:G(r,z,V(k,2)),t.match(/^_?_?/)&&(a="link");break;default:G(r,z)}else if(t.match(_))G(r,z),a="quote";else if(t.match(j))G(r,z),a="quote";else if(t.match(T))G(r,z),(!t.peek()||t.peek().match(/^\W$/))&&(a="link");else if(Y(r)==S||t.match(S,!1))switch(X(r)){case 0:!t.peek()||t.peek().match(/^\W$/)?G(r,z,V(S,1)):t.match(S);break;case 1:G(r,z,V(S,2)),t.match(/^`/),a="link";break;case 2:G(r,z,V(S,3)),t.match(h);break;case 3:G(r,z,V(S,4)),t.match(/^`_/),a="link";break;default:G(r,z)}else t.match(q)?G(r,B):t.next()&&G(r,z);return a}function F(t,r){var a=null;if(Y(r)==b||t.match(b,!1))switch(X(r)){case 0:G(r,F,V(b,1)),t.match(A),a="variable-2";break;case 1:G(r,F,V(b,2)),t.match(I);break;case 2:G(r,F,V(b,3)),t.match(M),a="keyword";break;case 3:G(r,F,V(b,4)),t.match(O),a="meta";break;default:G(r,z)}else if(Y(r)==v||t.match(v,!1))switch(X(r)){case 0:G(r,F,V(v,1)),t.match(N),a="keyword",t.current().match(/^(?:math|latex)/)?r.tmp_stex=!0:t.current().match(/^python/)&&(r.tmp_py=!0);break;case 1:G(r,F,V(v,2)),t.match($),a="meta",(t.match(/^latex\s*$/)||r.tmp_stex)&&(r.tmp_stex=void 0,G(r,W,{mode:n,local:e.startState(n)}));break;case 2:G(r,F,V(v,3)),(t.match(/^python\s*$/)||r.tmp_py)&&(r.tmp_py=void 0,G(r,W,{mode:i,local:e.startState(i)}));break;default:G(r,z)}else if(Y(r)==g||t.match(g,!1))switch(X(r)){case 0:G(r,F,V(g,1)),t.match(L),t.match(D),a="link";break;case 1:G(r,F,V(g,2)),t.match(R),a="meta";break;default:G(r,z)}else t.match(x)?(G(r,z),a="quote"):t.match(w)?(G(r,z),a="quote"):(t.eatSpace(),t.eol()?G(r,z):(t.skipToEnd(),G(r,H),a="comment"));return a}function H(e,t){return U(e,t,"comment")}function B(e,t){return U(e,t,"meta")}function U(e,t,r){return e.eol()||e.eatSpace()?(e.skipToEnd(),r):(G(t,z),null)}function W(e,t){return t.ctx.mode&&t.ctx.local?e.sol()?(e.eatSpace()||G(t,z),null):t.ctx.mode.token(e,t.ctx.local):(G(t,z),null)}function V(e,t,r,i){return{phase:e,stage:t,mode:r,local:i}}function G(e,t,r){e.tok=t,e.ctx=r||{}}function X(e){return e.ctx.stage||0}function Y(e){return e.ctx.phase}var i=e.getMode(t,"python"),n=e.getMode(t,"stex"),a="\\s+",o="(?:\\s*|\\W|$)",s=new RegExp(r("^{0}",o)),l="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",u=new RegExp(r("^{0}",l)),c="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",f=r("(?:{0}|`{1}`)",l,c),d="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",p="(?:[^\\`]+)",h=new RegExp(r("^{0}",p)),m=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),y=new RegExp(r("^\\.\\.{0}",a)),g=new RegExp(r("^_{0}:{1}|^__:{1}",f,o)),v=new RegExp(r("^{0}::{1}",f,o)),b=new RegExp(r("^\\|{0}\\|{1}{2}::{3}",d,a,f,o)),x=new RegExp(r("^\\[(?:\\d+|#{0}?|\\*)]{1}",f,o)),w=new RegExp(r("^\\[{0}\\]{1}",f,o)),k=new RegExp(r("^\\|{0}\\|",d)),_=new RegExp(r("^\\[(?:\\d+|#{0}?|\\*)]_",f)),j=new RegExp(r("^\\[{0}\\]_",f)),T=new RegExp(r("^{0}__?",f)),S=new RegExp(r("^`{0}`_",p)),Q=new RegExp(r("^:{0}:`{1}`{2}",l,p,o)),C=new RegExp(r("^`{1}`:{0}:{2}",l,p,o)),E=new RegExp(r("^:{0}:{1}",l,o)),N=new RegExp(r("^{0}",f)),$=new RegExp(r("^::{0}",o)),A=new RegExp(r("^\\|{0}\\|",d)),I=new RegExp(r("^{0}",a)),M=new RegExp(r("^{0}",f)),O=new RegExp(r("^::{0}",o)),L=new RegExp("^_"),D=new RegExp(r("^{0}|_",f)),R=new RegExp(r("^:{0}",o)),q=new RegExp("^::\\s*$"),P=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:z,ctx:V(void 0,0)}},copyState:function(t){var r=t.ctx,i=t.tmp;return r.local&&(r={mode:r.mode,local:e.copyState(r.mode,r.local)}),i&&(i={mode:i.mode,local:e.copyState(i.mode,i.local)}),{tok:t.tok,ctx:r,tmp:i}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}},"python","stex"),e.defineMIME("text/x-rst","rst")});
