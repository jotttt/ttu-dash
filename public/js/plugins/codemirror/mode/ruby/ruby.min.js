!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("ruby",function(e){function t(e){for(var t={},r=0,i=e.length;i>r;++r)t[e[r]]=!0;return t}function s(e,t,r){return r.tokenize.push(e),e(t,r)}function l(e,t){if(o=null,e.sol()&&e.match("=begin")&&e.eol())return t.tokenize.push(p),"comment";if(e.eatSpace())return null;var i,r=e.next();if("`"==r||"'"==r||'"'==r)return s(f(r,"string",'"'==r||"`"==r),e,t);if("/"==r){var n=e.current().length;if(e.skipTo("/")){var l=e.current().length;e.backUp(e.current().length-n);for(var u=0;e.current().length<l;){var c=e.next();if("("==c?u+=1:")"==c&&(u-=1),0>u)break}if(e.backUp(e.current().length-n),0==u)return s(f(r,"string-2",!0),e,t)}return"operator"}if("%"==r){var h="string",m=!0;e.eat("s")?h="atom":e.eat(/[WQ]/)?h="string":e.eat(/[r]/)?h="string-2":e.eat(/[wxq]/)&&(h="string",m=!1);var y=e.eat(/[^\w\s=]/);return y?(a.propertyIsEnumerable(y)&&(y=a[y]),s(f(y,h,m,!0),e,t)):"operator"}if("#"==r)return e.skipToEnd(),"comment";if("<"==r&&(i=e.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return s(d(i[1]),e,t);if("0"==r)return e.eat("x")?e.eatWhile(/[\da-fA-F]/):e.eat("b")?e.eatWhile(/[01]/):e.eatWhile(/[0-7]/),"number";if(/\d/.test(r))return e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if("?"==r){for(;e.match(/^\\[CM]-/););return e.eat("\\")?e.eatWhile(/\w/):e.next(),"string"}if(":"==r)return e.eat("'")?s(f("'","atom",!1),e,t):e.eat('"')?s(f('"',"atom",!0),e,t):e.eat(/[\<\>]/)?(e.eat(/[\<\>]/),"atom"):e.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":e.eat(/[a-zA-Z$@_\xa1-\uffff]/)?(e.eatWhile(/[\w$\xa1-\uffff]/),e.eat(/[\?\!\=]/),"atom"):"operator";if("@"==r&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/))return e.eat("@"),e.eatWhile(/[\w\xa1-\uffff]/),"variable-2";if("$"==r)return e.eat(/[a-zA-Z_]/)?e.eatWhile(/[\w]/):e.eat(/\d/)?e.eat(/\d/):e.next(),"variable-3";if(/[a-zA-Z_\xa1-\uffff]/.test(r))return e.eatWhile(/[\w\xa1-\uffff]/),e.eat(/[\?\!]/),e.eat(":")?"atom":"ident";if("|"!=r||!t.varList&&"{"!=t.lastTok&&"do"!=t.lastTok){if(/[\(\)\[\]{}\\;]/.test(r))return o=r,null;if("-"==r&&e.eat(">"))return"arrow";if(/[=+\-\/*:\.^%<>~|]/.test(r)){var g=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);return"."!=r||g||(o="."),"operator"}return null}return o="|",null}function u(e){return e||(e=1),function(t,r){if("}"==t.peek()){if(1==e)return r.tokenize.pop(),r.tokenize[r.tokenize.length-1](t,r);r.tokenize[r.tokenize.length-1]=u(e-1)}else"{"==t.peek()&&(r.tokenize[r.tokenize.length-1]=u(e+1));return l(t,r)}}function c(){var e=!1;return function(t,r){return e?(r.tokenize.pop(),r.tokenize[r.tokenize.length-1](t,r)):(e=!0,l(t,r))}}function f(e,t,r,i){return function(n,a){var s,o=!1;for("read-quoted-paused"===a.context.type&&(a.context=a.context.prev,n.eat("}"));null!=(s=n.next());){if(s==e&&(i||!o)){a.tokenize.pop();break}if(r&&"#"==s&&!o){if(n.eat("{")){"}"==e&&(a.context={prev:a.context,type:"read-quoted-paused"}),a.tokenize.push(u());break}if(/[@\$]/.test(n.peek())){a.tokenize.push(c());break}}o=!o&&"\\"==s}return t}}function d(e){return function(t,r){return t.match(e)?r.tokenize.pop():t.skipToEnd(),"string"}}function p(e,t){return e.sol()&&e.match("=end")&&e.eol()&&t.tokenize.pop(),e.skipToEnd(),"comment"}var o,r=t(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]),i=t(["def","class","case","for","while","module","then","catch","loop","proc","begin"]),n=t(["end","until"]),a={"[":"]","{":"}","(":")"};return{startState:function(){return{tokenize:[l],indented:0,context:{type:"top",indented:-e.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(e,t){e.sol()&&(t.indented=e.indentation());var s,a=t.tokenize[t.tokenize.length-1](e,t),l=o;if("ident"==a){var u=e.current();a="."==t.lastTok?"property":r.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(u)?"tag":"def"==t.lastTok||"class"==t.lastTok||t.varList?"def":"variable","keyword"==a&&(l=u,i.propertyIsEnumerable(u)?s="indent":n.propertyIsEnumerable(u)?s="dedent":"if"!=u&&"unless"!=u||e.column()!=e.indentation()?"do"==u&&t.context.indented<t.indented&&(s="indent"):s="indent")}return(o||a&&"comment"!=a)&&(t.lastTok=l),"|"==o&&(t.varList=!t.varList),"indent"==s||/[\(\[\{]/.test(o)?t.context={prev:t.context,type:o||a,indented:t.indented}:("dedent"==s||/[\)\]\}]/.test(o))&&t.context.prev&&(t.context=t.context.prev),e.eol()&&(t.continuedLine="\\"==o||"operator"==a),a},indent:function(t,r){if(t.tokenize[t.tokenize.length-1]!=l)return 0;var i=r&&r.charAt(0),n=t.context,o=n.type==a[i]||"keyword"==n.type&&/^(?:end|until|else|elsif|when|rescue)\b/.test(r);return n.indented+(o?0:e.indentUnit)+(t.continuedLine?e.indentUnit:0)},electricChars:"}de",lineComment:"#"}}),e.defineMIME("text/x-ruby","ruby")});
