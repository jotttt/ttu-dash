!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("smalltalk",function(e){var t=/[+\-\/\\*~<>=@%|&?!.,:;^]/,r=/true|false|nil|self|super|thisContext/,i=function(e,t){this.next=e,this.parent=t},n=function(e,t,r){this.name=e,this.context=t,this.eos=r},a=function(){this.context=new i(o,null),this.expectVariable=!0,this.indentation=0,this.userIndentationDelta=0};a.prototype.userIndent=function(t){this.userIndentationDelta=t>0?t/e.indentUnit-this.indentation:0};var o=function(e,a,o){var f=new n(null,a,!1),d=e.next();return'"'===d?f=s(e,new i(s,a)):"'"===d?f=l(e,new i(l,a)):"#"===d?"'"===e.peek()?(e.next(),f=u(e,new i(u,a))):e.eatWhile(/[^\s.{}\[\]()]/)?f.name="string-2":f.name="meta":"$"===d?("<"===e.next()&&(e.eatWhile(/[^\s>]/),e.next()),f.name="string-2"):"|"===d&&o.expectVariable?f.context=new i(c,a):/[\[\]{}()]/.test(d)?(f.name="bracket",f.eos=/[\[{(]/.test(d),"["===d?o.indentation++:"]"===d&&(o.indentation=Math.max(0,o.indentation-1))):t.test(d)?(e.eatWhile(t),f.name="operator",f.eos=";"!==d):/\d/.test(d)?(e.eatWhile(/[\w\d]/),f.name="number"):/[\w_]/.test(d)?(e.eatWhile(/[\w\d_]/),f.name=o.expectVariable?r.test(e.current())?"keyword":"variable":null):f.eos=o.expectVariable,f},s=function(e,t){return e.eatWhile(/[^"]/),new n("comment",e.eat('"')?t.parent:t,!0)},l=function(e,t){return e.eatWhile(/[^']/),new n("string",e.eat("'")?t.parent:t,!1)},u=function(e,t){return e.eatWhile(/[^']/),new n("string-2",e.eat("'")?t.parent:t,!1)},c=function(e,t){var r=new n(null,t,!1),i=e.next();return"|"===i?(r.context=t.parent,r.eos=!0):(e.eatWhile(/[^|]/),r.name="variable"),r};return{startState:function(){return new a},token:function(e,t){if(t.userIndent(e.indentation()),e.eatSpace())return null;var r=t.context.next(e,t.context,t);return t.context=r.context,t.expectVariable=r.eos,r.name},blankLine:function(e){e.userIndent(0)},indent:function(t,r){var i=t.context.next===o&&r&&"]"===r.charAt(0)?-1:t.userIndentationDelta;return(t.indentation+i)*e.indentUnit},electricChars:"]"}}),e.defineMIME("text/x-stsrc",{name:"smalltalk"})});
