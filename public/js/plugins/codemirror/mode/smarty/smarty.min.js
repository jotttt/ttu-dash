!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("smarty",function(e){var t={rightDelimiter:"}",leftDelimiter:"{",smartyVersion:2};e.hasOwnProperty("leftDelimiter")&&(t.leftDelimiter=e.leftDelimiter),e.hasOwnProperty("rightDelimiter")&&(t.rightDelimiter=e.rightDelimiter),e.hasOwnProperty("smartyVersion")&&3===e.smartyVersion&&(t.smartyVersion=3);var i,r=["debug","extends","function","include","literal"],n={operatorChars:/[+\-*&%=<>!?]/,validIdentifier:/[a-zA-Z0-9_]/,stringChar:/['"]/},a={cont:function(e,t){return i=t,e},chain:function(e,t,r){return t.tokenize=r,r(e,t)}},o={tokenizer:function(e,r){if(e.match(t.leftDelimiter,!0)){if(e.eat("*"))return a.chain(e,r,o.inBlock("comment","*"+t.rightDelimiter));r.depth++;var n=e.eol(),s=/\s/.test(e.peek());return 3===t.smartyVersion&&"{"===t.leftDelimiter&&(n||s)?(r.depth--,null):(r.tokenize=o.smarty,i="startTag","tag")}return e.next(),null},smarty:function(e,s){if(e.match(t.rightDelimiter,!0))return 3===t.smartyVersion?(s.depth--,s.depth<=0&&(s.tokenize=o.tokenizer)):s.tokenize=o.tokenizer,a.cont("tag",null);if(e.match(t.leftDelimiter,!0))return s.depth++,a.cont("tag","startTag");var l=e.next();if("$"==l)return e.eatWhile(n.validIdentifier),a.cont("variable-2","variable");if("|"==l)return a.cont("operator","pipe");if("."==l)return a.cont("operator","property");if(n.stringChar.test(l))return s.tokenize=o.inAttribute(l),a.cont("string","string");if(n.operatorChars.test(l))return e.eatWhile(n.operatorChars),a.cont("operator","operator");if("["==l||"]"==l)return a.cont("bracket","bracket");if("("==l||")"==l)return a.cont("bracket","operator");if(/\d/.test(l))return e.eatWhile(/\d/),a.cont("number","number");if("variable"==s.last){if("@"==l)return e.eatWhile(n.validIdentifier),a.cont("property","property");if("|"==l)return e.eatWhile(n.validIdentifier),a.cont("qualifier","modifier")}else{if("pipe"==s.last)return e.eatWhile(n.validIdentifier),a.cont("qualifier","modifier");if("whitespace"==s.last)return e.eatWhile(n.validIdentifier),a.cont("attribute","modifier")}if("property"==s.last)return e.eatWhile(n.validIdentifier),a.cont("property",null);if(/\s/.test(l))return i="whitespace",null;var u="";"/"!=l&&(u+=l);for(var c=null;c=e.eat(n.validIdentifier);)u+=c;for(var f=0,d=r.length;d>f;f++)if(r[f]==u)return a.cont("keyword","keyword");return/\s/.test(l)?null:a.cont("tag","tag")},inAttribute:function(e){return function(t,r){for(var i=null,n=null;!t.eol();){if(n=t.peek(),t.next()==e&&"\\"!==i){r.tokenize=o.smarty;break}i=n}return"string"}},inBlock:function(e,t){return function(r,i){for(;!r.eol();){if(r.match(t)){i.tokenize=o.tokenizer;break}r.next()}return e}}};return{startState:function(){return{tokenize:o.tokenizer,mode:"smarty",last:null,depth:0}},token:function(e,t){var r=t.tokenize(e,t);return t.last=i,r},electricChars:""}}),e.defineMIME("text/x-smarty","smarty")});
