!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("tiki",function(e){function t(e,t,r){return function(n,a){for(;!n.eol();){if(n.match(t)){a.tokenize=i;break}n.next()}return r&&(a.tokenize=r),e}}function r(e){return function(t,r){for(;!t.eol();)t.next();return r.tokenize=i,e}}function i(e,n){function a(t){return n.tokenize=t,t(e,n)}var o=e.sol(),l=e.next();switch(l){case"{":e.eat("/"),e.eatSpace();for(var c,u="";c=e.eat(/[^\s\u00a0=\"\'\/?(}]/);)u+=c;return n.tokenize=s,"tag";case"_":if(e.eat("_"))return a(t("strong","__",i));break;case"'":if(e.eat("'"))return a(t("em","''",i));break;case"(":if(e.eat("("))return a(t("variable-2","))",i));break;case"[":return a(t("variable-3","]",i));case"|":if(e.eat("|"))return a(t("comment","||"));break;case"-":if(e.eat("="))return a(t("header string","=-",i));if(e.eat("-"))return a(t("error tw-deleted","--",i));break;case"=":if(e.match("=="))return a(t("tw-underline","===",i));break;case":":if(e.eat(":"))return a(t("comment","::"));break;case"^":return a(t("tw-box","^"));case"~":if(e.match("np~"))return a(t("meta","~/np~"))}if(o)switch(l){case"!":return a(e.match("!!!!!")?r("header string"):e.match("!!!!")?r("header string"):e.match("!!!")?r("header string"):e.match("!!")?r("header string"):r("header string"));case"*":case"#":case"+":return a(r("tw-listitem bracket"))}return null}function s(e,t){var r=e.next(),n=e.peek();return"}"==r?(t.tokenize=i,"tag"):"("==r||")"==r?"bracket":"="==r?(o="equals",">"==n&&(r=e.next(),n=e.peek()),/[\'\"]/.test(n)||(t.tokenize=u()),"operator"):/[\'\"]/.test(r)?(t.tokenize=l(r),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=\"\'\/?]/),"keyword")}function l(e){return function(t,r){for(;!t.eol();)if(t.next()==e){r.tokenize=s;break}return"string"}}function u(){return function(e,t){for(;!e.eol();){var r=e.next(),i=e.peek();if(" "==r||","==r||/[ )}]/.test(i)){t.tokenize=s;break}}return"string"}}function d(){for(var e=arguments.length-1;e>=0;e--)c.cc.push(arguments[e])}function h(){return d.apply(null,arguments),!0}function p(e,t){var r=c.context&&c.context.noIndent;c.context={prev:c.context,pluginName:e,indent:c.indented,startOfLine:t,noIndent:r}}function m(){c.context&&(c.context=c.context.prev)}function g(e){if("openPlugin"==e)return c.pluginName=a,h(b,y(c.startOfLine));if("closePlugin"==e){var t=!1;return c.context?(t=c.context.pluginName!=a,m()):t=!0,t&&(f="error"),h(v(t))}return"string"==e?(c.context&&"!cdata"==c.context.name||p("!cdata"),c.tokenize==i&&m(),h()):h()}function y(e){return function(t){return"selfclosePlugin"==t||"endPlugin"==t?h():"endPlugin"==t?(p(c.pluginName,e),h()):h()}}function v(e){return function(t){return e&&(f="error"),"endPlugin"==t?h():d()}}function b(e){return"keyword"==e?(f="attribute",h(b)):"equals"==e?h(x,b):d()}function x(e){return"keyword"==e?(f="string",h()):"string"==e?h(w):d()}function w(e){return"string"==e?h(w):d()}var a,o,c,f,n=e.indentUnit;return{startState:function(){return{tokenize:i,cc:[],indented:0,startOfLine:!0,pluginName:null,context:null}},token:function(e,t){if(e.sol()&&(t.startOfLine=!0,t.indented=e.indentation()),e.eatSpace())return null;f=o=a=null;var r=t.tokenize(e,t);if((r||o)&&"comment"!=r)for(c=t;;){var i=t.cc.pop()||g;if(i(o||r))break}return t.startOfLine=!1,f||r},indent:function(e,t){var r=e.context;if(r&&r.noIndent)return 0;for(r&&/^{\//.test(t)&&(r=r.prev);r&&!r.startOfLine;)r=r.prev;return r?r.indent+n:0},electricChars:"/"}}),e.defineMIME("text/tiki","tiki")});
