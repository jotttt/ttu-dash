!function(e){function i(i){function h(t,r,i){c||(c=!0,n=t.getCanvas(),a=e(n).parent(),o=t.getOptions(),t.setData(p(t.getData())))}function p(t){for(var r=0,i=0,n=0,a=o.series.pie.combine.color,s=[],l=0;l<t.length;++l){var u=t[l].data;e.isArray(u)&&1==u.length&&(u=u[0]),e.isArray(u)?!isNaN(parseFloat(u[1]))&&isFinite(u[1])?u[1]=+u[1]:u[1]=0:u=!isNaN(parseFloat(u))&&isFinite(u)?[1,+u]:[1,0],t[l].data=[u]}for(var l=0;l<t.length;++l)r+=t[l].data[0][1];for(var l=0;l<t.length;++l){var u=t[l].data[0][1];u/r<=o.series.pie.combine.threshold&&(i+=u,n++,a||(a=t[l].color))}for(var l=0;l<t.length;++l){var u=t[l].data[0][1];(2>n||u/r>o.series.pie.combine.threshold)&&s.push(e.extend(t[l],{data:[[1,u]],color:t[l].color,label:t[l].label,angle:u*Math.PI*2/r,percent:u/(r/100)}))}return n>1&&s.push({data:[[1,i]],color:a,label:o.series.pie.combine.label,angle:i*Math.PI*2/r,percent:i/(r/100)}),s}function m(i,n){function y(){f.clearRect(0,0,d,h),a.children().filter(".pieLabel, .pieLabelBackground").remove()}function b(){var e=o.series.pie.shadow.left,t=o.series.pie.shadow.top,r=10,i=o.series.pie.shadow.alpha,n=o.series.pie.radius>1?o.series.pie.radius:s*o.series.pie.radius;if(!(n>=d/2-e||n*o.series.pie.tilt>=h/2-t||r>=n)){f.save(),f.translate(e,t),f.globalAlpha=i,f.fillStyle="#000",f.translate(l,u),f.scale(1,o.series.pie.tilt);for(var a=1;r>=a;a++)f.beginPath(),f.arc(0,0,n,0,2*Math.PI,!1),f.fill(),n-=a;f.restore()}}function x(){function c(e,t,n){0>=e||isNaN(e)||(n?f.fillStyle=t:(f.strokeStyle=t,f.lineJoin="round"),f.beginPath(),Math.abs(e-2*Math.PI)>1e-9&&f.moveTo(0,0),f.arc(0,0,r,i,i+e/2,!1),f.arc(0,0,r,i+e/2,i+e,!1),f.closePath(),i+=e,n?f.fill():f.stroke())}function p(){function c(t,r,n){if(0==t.data[0][1])return!0;var c,s=o.legend.labelFormatter,f=o.series.pie.label.formatter;c=s?s(t.label,t):t.label,f&&(c=f(c,t));var p=(r+t.angle+r)/2,m=l+Math.round(Math.cos(p)*i),g=u+Math.round(Math.sin(p)*i)*o.series.pie.tilt,v="<span class='pieLabel' id='pieLabel"+n+"' style='position:absolute;top:"+g+"px;left:"+m+"px;'>"+c+"</span>";a.append(v);var y=a.children("#pieLabel"+n),b=g-y.height()/2,x=m-y.width()/2;if(y.css("top",b),y.css("left",x),0-b>0||0-x>0||h-(b+y.height())<0||d-(x+y.width())<0)return!1;if(0!=o.series.pie.label.background.opacity){var w=o.series.pie.label.background.color;null==w&&(w=t.color);var k="top:"+b+"px;left:"+x+"px;";e("<div class='pieLabelBackground' style='position:absolute;width:"+y.width()+"px;height:"+y.height()+"px;"+k+"background-color:"+w+";'></div>").css("opacity",o.series.pie.label.background.opacity).insertBefore(y)}return!0}for(var r=t,i=o.series.pie.label.radius>1?o.series.pie.label.radius:s*o.series.pie.label.radius,n=0;n<m.length;++n){if(m[n].percent>=100*o.series.pie.label.threshold&&!c(m[n],r,n))return!1;r+=m[n].angle}return!0}var t=Math.PI*o.series.pie.startAngle,r=o.series.pie.radius>1?o.series.pie.radius:s*o.series.pie.radius;f.save(),f.translate(l,u),f.scale(1,o.series.pie.tilt),f.save();for(var i=t,n=0;n<m.length;++n)m[n].startAngle=i,c(m[n].angle,m[n].color,!0);if(f.restore(),o.series.pie.stroke.width>0){f.save(),f.lineWidth=o.series.pie.stroke.width,i=t;for(var n=0;n<m.length;++n)c(m[n].angle,o.series.pie.stroke.color,!1);f.restore()}return g(f),f.restore(),o.series.pie.label.show?p():!0}if(a){var d=i.getPlaceholder().width(),h=i.getPlaceholder().height(),p=a.children().filter(".legend").children().width()||0;f=n,c=!1,s=Math.min(d,h/o.series.pie.tilt)/2,u=h/2+o.series.pie.offset.top,l=d/2,"auto"==o.series.pie.offset.left?(o.legend.position.match("w")?l+=p/2:l-=p/2,s>l?l=s:l>d-s&&(l=d-s)):l+=o.series.pie.offset.left;var m=i.getData(),v=0;do v>0&&(s*=r),v+=1,y(),o.series.pie.tilt<=.8&&b();while(!x()&&t>v);v>=t&&(y(),a.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),i.setSeries&&i.insertLegend&&(i.setSeries(m),i.insertLegend())}}function g(e){if(o.series.pie.innerRadius>0){e.save();var t=o.series.pie.innerRadius>1?o.series.pie.innerRadius:s*o.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=o.series.pie.stroke.color,e.arc(0,0,t,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=o.series.pie.stroke.color,e.arc(0,0,t,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function v(e,t){for(var r=!1,i=-1,n=e.length,a=n-1;++i<n;a=i)(e[i][1]<=t[1]&&t[1]<e[a][1]||e[a][1]<=t[1]&&t[1]<e[i][1])&&t[0]<(e[a][0]-e[i][0])*(t[1]-e[i][1])/(e[a][1]-e[i][1])+e[i][0]&&(r=!r);return r}function y(e,t){for(var o,c,r=i.getData(),n=i.getOptions(),a=n.series.pie.radius>1?n.series.pie.radius:s*n.series.pie.radius,d=0;d<r.length;++d){var h=r[d];if(h.pie.show){if(f.save(),f.beginPath(),f.moveTo(0,0),f.arc(0,0,a,h.startAngle,h.startAngle+h.angle/2,!1),f.arc(0,0,a,h.startAngle+h.angle/2,h.startAngle+h.angle,!1),f.closePath(),o=e-l,c=t-u,f.isPointInPath){if(f.isPointInPath(e-l,t-u))return f.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:d}}else{var p=a*Math.cos(h.startAngle),m=a*Math.sin(h.startAngle),g=a*Math.cos(h.startAngle+h.angle/4),y=a*Math.sin(h.startAngle+h.angle/4),b=a*Math.cos(h.startAngle+h.angle/2),x=a*Math.sin(h.startAngle+h.angle/2),w=a*Math.cos(h.startAngle+h.angle/1.5),k=a*Math.sin(h.startAngle+h.angle/1.5),_=a*Math.cos(h.startAngle+h.angle),S=a*Math.sin(h.startAngle+h.angle),j=[[0,0],[p,m],[g,y],[b,x],[w,k],[_,S]],T=[o,c];if(v(j,T))return f.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:d}}f.restore()}}return null}function b(e){w("plothover",e)}function x(e){w("plotclick",e)}function w(e,t){var r=i.offset(),n=parseInt(t.pageX-r.left),s=parseInt(t.pageY-r.top),l=y(n,s);if(o.grid.autoHighlight)for(var u=0;u<d.length;++u){var c=d[u];c.auto!=e||l&&c.series==l.series||_(c.series)}l&&k(l.series,e);var f={pageX:t.pageX,pageY:t.pageY};a.trigger(e,[f,l])}function k(e,t){var r=S(e);-1==r?(d.push({series:e,auto:t}),i.triggerRedrawOverlay()):t||(d[r].auto=!1)}function _(e){null==e&&(d=[],i.triggerRedrawOverlay());var t=S(e);-1!=t&&(d.splice(t,1),i.triggerRedrawOverlay())}function S(e){for(var t=0;t<d.length;++t){var r=d[t];if(r.series==e)return t}return-1}function j(e,t){function a(e){e.angle<=0||isNaN(e.angle)||(t.fillStyle="rgba(255, 255, 255, "+r.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&t.moveTo(0,0),t.arc(0,0,i,e.startAngle,e.startAngle+e.angle/2,!1),t.arc(0,0,i,e.startAngle+e.angle/2,e.startAngle+e.angle,!1),t.closePath(),t.fill())}var r=e.getOptions(),i=r.series.pie.radius>1?r.series.pie.radius:s*r.series.pie.radius;t.save(),t.translate(l,u),t.scale(1,r.series.pie.tilt);for(var n=0;n<d.length;++n)a(d[n].series);g(t),t.restore()}var n=null,a=null,o=null,s=null,l=null,u=null,c=!1,f=null,d=[];i.hooks.processOptions.push(function(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),t.series.pie.tilt>1?t.series.pie.tilt=1:t.series.pie.tilt<0&&(t.series.pie.tilt=0))}),i.hooks.bindEvents.push(function(e,t){var r=e.getOptions();r.series.pie.show&&(r.grid.hoverable&&t.unbind("mousemove").mousemove(b),r.grid.clickable&&t.unbind("click").click(x))}),i.hooks.processDatapoints.push(function(e,t,r,i){var n=e.getOptions();n.series.pie.show&&h(e,t,r,i)}),i.hooks.drawOverlay.push(function(e,t){var r=e.getOptions();r.series.pie.show&&j(e,t)}),i.hooks.draw.push(function(e,t){var r=e.getOptions();r.series.pie.show&&m(e,t)})}var t=10,r=.95,n={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,t){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+t.color+";'>"+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:i,options:n,name:"pie",version:"1.1"})}(jQuery);
