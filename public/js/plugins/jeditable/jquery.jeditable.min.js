!function($){$.fn.editable=function(e,t){if("disable"==e)return void $(this).data("disabled.editable",!0);if("enable"==e)return void $(this).data("disabled.editable",!1);if("destroy"==e)return void $(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");var r=$.extend({},$.fn.editable.defaults,{target:e},t),i=$.editable.types[r.type].plugin||function(){},n=$.editable.types[r.type].submit||function(){},a=$.editable.types[r.type].buttons||$.editable.types.defaults.buttons,o=$.editable.types[r.type].content||$.editable.types.defaults.content,s=$.editable.types[r.type].element||$.editable.types.defaults.element,l=$.editable.types[r.type].reset||$.editable.types.defaults.reset,u=r.callback||function(){},c=r.onedit||function(){},f=r.onsubmit||function(){},d=r.onreset||function(){},h=r.onerror||l;return r.tooltip&&$(this).attr("title",r.tooltip),r.autowidth="auto"==r.width,r.autoheight="auto"==r.height,this.each(function(){var e=this,t=$(e).width(),p=$(e).height();$(this).data("event.editable",r.event),$.trim($(this).html())||$(this).html(r.placeholder),$(this).bind(r.event,function(d){if(!0!==$(this).data("disabled.editable")&&!e.editing&&!1!==c.apply(this,[r,e])){d.preventDefault(),d.stopPropagation(),r.tooltip&&$(e).removeAttr("title"),0==$(e).width()?(r.width=t,r.height=p):("none"!=r.width&&(r.width=r.autowidth?$(e).width():r.width),"none"!=r.height&&(r.height=r.autoheight?$(e).height():r.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==r.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),e.editing=!0,e.revert=$(e).html(),$(e).html("");var m=$("<form />");r.cssclass&&("inherit"==r.cssclass?m.attr("class",$(e).attr("class")):m.attr("class",r.cssclass)),r.style&&("inherit"==r.style?(m.attr("style",$(e).attr("style")),m.css("display",$(e).css("display"))):m.attr("style",r.style));var v,g=s.apply(m,[r,e]);if(r.loadurl){var y=setTimeout(function(){g.disabled=!0,o.apply(m,[r.loadtext,r,e])},100),b={};b[r.id]=e.id,$.isFunction(r.loaddata)?$.extend(b,r.loaddata.apply(e,[e.revert,r])):$.extend(b,r.loaddata),$.ajax({type:r.loadtype,url:r.loadurl,data:b,async:!1,success:function(e){window.clearTimeout(y),v=e,g.disabled=!1}})}else r.data?(v=r.data,$.isFunction(r.data)&&(v=r.data.apply(e,[e.revert,r]))):v=e.revert;o.apply(m,[v,r,e]),g.attr("name",r.name),a.apply(m,[r,e]),$(e).append(m),i.apply(m,[r,e]),$(":input:visible:enabled:first",m).focus(),r.select&&g.select(),g.keydown(function(t){27==t.keyCode&&(t.preventDefault(),l.apply(m,[r,e]))});var y;"cancel"==r.onblur?g.blur(function(t){y=setTimeout(function(){l.apply(m,[r,e])},500)}):"submit"==r.onblur?g.blur(function(e){y=setTimeout(function(){m.submit()},200)}):$.isFunction(r.onblur)?g.blur(function(t){r.onblur.apply(e,[g.val(),r])}):g.blur(function(e){}),m.submit(function(t){if(y&&clearTimeout(y),t.preventDefault(),!1!==f.apply(m,[r,e])&&!1!==n.apply(m,[r,e]))if($.isFunction(r.target)){var i=r.target.apply(e,[g.val(),r]);$(e).html(i),e.editing=!1,u.apply(e,[e.innerHTML,r]),$.trim($(e).html())||$(e).html(r.placeholder)}else{var a={};a[r.name]=g.val(),a[r.id]=e.id,$.isFunction(r.submitdata)?$.extend(a,r.submitdata.apply(e,[e.revert,r])):$.extend(a,r.submitdata),"PUT"==r.method&&(a._method="put"),$(e).html(r.indicator);var o={type:"POST",data:a,dataType:"html",url:r.target,success:function(t,i){"html"==o.dataType&&$(e).html(t),e.editing=!1,u.apply(e,[t,r]),$.trim($(e).html())||$(e).html(r.placeholder)},error:function(t,i,n){h.apply(m,[r,e,t])}};$.extend(o,r.ajaxoptions),$.ajax(o)}return $(e).attr("title",r.tooltip),!1})}}),this.reset=function(t){this.editing&&!1!==d.apply(t,[r,e])&&($(e).html(e.revert),e.editing=!1,$.trim($(e).html())||$(e).html(r.placeholder),r.tooltip&&$(e).attr("title",r.tooltip))}})},$.editable={types:{defaults:{element:function(e,t){var r=$('<input type="hidden"></input>');return $(this).append(r),r},content:function(e,t,r){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(e,t){var r=this;if(e.submit){if(e.submit.match(/>$/))var i=$(e.submit).click(function(){"submit"!=i.attr("type")&&r.submit()});else{var i=$('<button type="submit" />');i.html(e.submit)}$(this).append(i)}if(e.cancel){if(e.cancel.match(/>$/))var n=$(e.cancel);else{var n=$('<button type="cancel" />');n.html(e.cancel)}$(this).append(n),$(n).click(function(i){if($.isFunction($.editable.types[e.type].reset))var n=$.editable.types[e.type].reset;else var n=$.editable.types.defaults.reset;return n.apply(r,[e,t]),!1})}}},text:{element:function(e,t){var r=$("<input />");return"none"!=e.width&&r.width(e.width),"none"!=e.height&&r.height(e.height),r.attr("autocomplete","off"),$(this).append(r),r}},textarea:{element:function(e,t){var r=$("<textarea />");return e.rows?r.attr("rows",e.rows):"none"!=e.height&&r.height(e.height),e.cols?r.attr("cols",e.cols):"none"!=e.width&&r.width(e.width),$(this).append(r),r}},select:{element:function(e,t){var r=$("<select />");return $(this).append(r),r},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){($(this).val()==json.selected||$(this).text()==$.trim(original.revert))&&$(this).attr("selected","selected")})}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}}(jQuery);
