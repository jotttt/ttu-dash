!function(e){e.fn.justifiedGallery=function(t){function r(e,t){return'<div class="jg-error '+t+'"style="">'+e+"</div>"}function n(t,i,r){e(t).find(".jg-loading").fadeOut(500,function(){e(this).remove(),l(e,t,i,0,r),e.isFunction(r.onComplete)&&r.onComplete.call(this,t)})}function a(e,t,i,r,n,a,o){var s;return s='<div class="jg-image" style="left:'+n+'px">',s+=' <a href="'+e.href+'" ',"undefined"!=typeof e.rel&&(s+='rel="'+e.rel+'"'),"undefined"!=typeof e.target&&(s+='target="'+e.target+'"'),s+='title="'+e.title+'">',s+='  <img alt="'+e.alt+'" src="'+e.src+t+e.extension+'"',s+='style="width: '+i+"px; height: "+r+'px;">',o.captions&&(s+='  <div style="bottom:'+(r-a)+'px;" class="jg-image-label">'+e.alt+"</div>"),s+=" </a></div>"}function o(e,t,i,r){for(var n,l,o=0,n=0;n<e.length;n++)e[n].nh=Math.ceil(t[e[n].indx].height*((t[e[n].indx].width+i)/t[e[n].indx].width)),e[n].nw=t[e[n].indx].width+i,e[n].suffix=s(e[n].nw,e[n].nh,r),e[n].l=o,r.fixedHeight||(0==n?l=e[n].nh:l>e[n].nh&&(l=e[n].nh)),o+=e[n].nw+r.margins;r.fixedHeight&&(l=r.rowHeight);for(var u="",n=0;n<e.length;n++)u+=a(t[e[n].indx],e[n].suffix,e[n].nw,e[n].nh,e[n].l,l,r);return'<div class="jg-row" style="height: '+l+"px; margin-bottom:"+r.margins+'px;">'+u+"</div>"}function s(e,t,i){var r;return r=e>t?e:t,100>=r?i.sizeRangeSuffixes.lt100:240>=r?i.sizeRangeSuffixes.lt240:320>=r?i.sizeRangeSuffixes.lt320:500>=r?i.sizeRangeSuffixes.lt500:640>=r?i.sizeRangeSuffixes.lt640:i.sizeRangeSuffixes.lt1024}function l(e,t,i,n,a){var l,c,d,s=new Array,f=0,h=e(t).width();for(c=0,l=0;c<i.length;c++)null!=i[c]&&(f+i[c].width+a.margins<=h?(f+=i[c].width+a.margins,s[l]=new Array(5),s[l].indx=c,l++):(d=Math.ceil((h-f+1)/s.length),e(t).append(o(s,i,d,a)),s=new Array,s[0]=new Array(5),s[0].indx=c,l=1,f=i[c].width+a.margins));d=a.justifyLastRow?Math.ceil((h-f+1)/s.length):0,e(t).append(o(s,i,d,a)),a.captions&&(e(t).find(".jg-image").mouseenter(function(t){e(t.currentTarget).find(".jg-image-label").stop(),e(t.currentTarget).find(".jg-image-label").fadeTo(500,.7)}),e(t).find(".jg-image").mouseleave(function(t){e(t.currentTarget).find(".jg-image-label").stop(),e(t.currentTarget).find(".jg-image-label").fadeTo(500,0)})),e(t).find(".jg-resizedImageNotFound").remove(),e(t).find(".jg-image img").load(function(){e(this).fadeTo(500,1)}).error(function(){e(t).prepend(r("The image can't be loaded: \""+e(this).attr("src")+'"',"jg-resizedImageNotFound"))}).each(function(){this.complete&&e(this).load()}),u(e,t,i,h,a)}function u(e,t,i,r,n){var a=setInterval(function(){return r!=e(t).width()?(e(t).find(".jg-row").remove(),clearInterval(a),void l(e,t,i,r,n)):void 0},n.refreshTime)}var i=e.extend({sizeRangeSuffixes:{lt100:"_t",lt240:"_m",lt320:"_n",lt500:"",lt640:"_z",lt1024:"_b"},rowHeight:120,margins:1,justifyLastRow:!0,fixedHeight:!1,captions:!0,rel:null,target:null,extension:/\.[^.]+$/,refreshTime:500,onComplete:null},t);return this.each(function(t,a){e(a).addClass("justifiedGallery");var o=0,s=new Array(e(a).find("img").length);0!=s.length&&(e(a).append('<div class="jg-loading"><div class="jg-loading-img"></div></div>'),e(a).find("a").each(function(t,l){var u=e(l).find("img");s[t]=new Array(5),s[t].src="undefined"!=typeof e(u).data("safe-src")?e(u).data("safe-src"):e(u).attr("src"),s[t].alt=e(u).attr("alt"),s[t].href=e(l).attr("href"),s[t].title=e(l).attr("title"),s[t].rel=null!=i.rel?i.rel:e(l).attr("rel"),s[t].target=null!=i.target?i.target:e(l).attr("target"),s[t].extension=s[t].src.match(i.extension)[0],e(l).remove();var c=new Image;e(c).load(function(){s[t].height!=i.rowHeight?s[t].width=Math.ceil(this.width/(this.height/i.rowHeight)):s[t].width=this.width,s[t].height=i.rowHeight;var e=new RegExp("("+i.sizeRangeSuffixes.lt100+"|"+i.sizeRangeSuffixes.lt240+"|"+i.sizeRangeSuffixes.lt320+"|"+i.sizeRangeSuffixes.lt500+"|"+i.sizeRangeSuffixes.lt640+"|"+i.sizeRangeSuffixes.lt1024+")$");s[t].src=s[t].src.replace(i.extension,"").replace(e,""),++o==s.length&&n(a,s,i)}),e(c).error(function(){e(a).prepend(r("The image can't be loaded: \""+s[t].src+'"',"jg-usedPrefixImageNotFound")),s[t]=null,++o==s.length&&n(a,s,i)}),e(c).attr("src",s[t].src)}))})}}(jQuery);
