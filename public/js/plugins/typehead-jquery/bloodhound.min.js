!function(e,t){"function"==typeof define&&define.amd?define("bloodhound",["jquery"],function(i){return e.Bloodhound=t(i)}):"object"==typeof exports?module.exports=t(require("jquery")):e.Bloodhound=t(jQuery)}(this,function(e){var t=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(e){return!e||/^\s*$/.test(e)},escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isArray:e.isArray,isFunction:e.isFunction,isObject:e.isPlainObject,isUndefined:function(e){return"undefined"==typeof e},isElement:function(e){return!(!e||1!==e.nodeType)},isJQuery:function(t){return t instanceof e},toStr:function(e){return t.isUndefined(e)||null===e?"":e+""},bind:e.proxy,each:function(t,i){function r(e,t){return i(t,e)}e.each(t,r)},map:e.map,filter:e.grep,every:function(t,i){var r=!0;return t?(e.each(t,function(e,n){return(r=i.call(null,n,e,t))?void 0:!1}),!!r):r},some:function(t,i){var r=!1;return t?(e.each(t,function(e,n){return(r=i.call(null,n,e,t))?!1:void 0}),!!r):r},mixin:e.extend,identity:function(e){return e},clone:function(t){return e.extend(!0,{},t)},getIdGenerator:function(){var e=0;return function(){return e++}},templatify:function(t){function i(){return String(t)}return e.isFunction(t)?t:i},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var r,n;return function(){var l,s,a=this,o=arguments;return l=function(){r=null,i||(n=e.apply(a,o))},s=i&&!r,clearTimeout(r),r=setTimeout(l,t),s&&(n=e.apply(a,o)),n}},throttle:function(e,t){var i,r,n,a,o,l;return o=0,l=function(){o=new Date,n=null,a=e.apply(i,r)},function(){var s=new Date,u=t-(s-o);return i=this,r=arguments,0>=u?(clearTimeout(n),n=null,o=s,a=e.apply(i,r)):n||(n=setTimeout(l,u)),a}},stringify:function(e){return t.isString(e)?e:JSON.stringify(e)},noop:function(){}}}(),i="0.11.1",r=function(){"use strict";function e(e){return e=t.toStr(e),e?e.split(/\s+/):[]}function i(e){return e=t.toStr(e),e?e.split(/\W+/):[]}function r(e){return function(i){return i=t.isArray(i)?i:[].slice.call(arguments,0),function(r){var n=[];return t.each(i,function(i){n=n.concat(e(t.toStr(r[i])))}),n}}}return{nonword:i,whitespace:e,obj:{nonword:r(i),whitespace:r(e)}}}(),n=function(){"use strict";function i(i){this.maxSize=t.isNumber(i)?i:100,this.reset(),this.maxSize<=0&&(this.set=this.get=e.noop)}function r(){this.head=this.tail=null}function n(e,t){this.key=e,this.val=t,this.prev=this.next=null}return t.mixin(i.prototype,{set:function(e,t){var r,i=this.list.tail;this.size>=this.maxSize&&(this.list.remove(i),delete this.hash[i.key],this.size--),(r=this.hash[e])?(r.val=t,this.list.moveToFront(r)):(r=new n(e,t),this.list.add(r),this.hash[e]=r,this.size++)},get:function(e){var t=this.hash[e];return t?(this.list.moveToFront(t),t.val):void 0},reset:function(){this.size=0,this.hash={},this.list=new r}}),t.mixin(r.prototype,{add:function(e){this.head&&(e.next=this.head,this.head.prev=e),this.head=e,this.tail=this.tail||e},remove:function(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev},moveToFront:function(e){this.remove(e),this.add(e)}}),i}(),a=function(){"use strict";function n(e,r){this.prefix=["__",e,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+t.escapeRegExChars(this.prefix)),this.ls=r||i,!this.ls&&this._noop()}function a(){return(new Date).getTime()}function o(e){return JSON.stringify(t.isUndefined(e)?null:e)}function l(t){return e.parseJSON(t)}function s(e){var t,r,n=[],a=i.length;for(t=0;a>t;t++)(r=i.key(t)).match(e)&&n.push(r.replace(e,""));return n}var i;try{i=window.localStorage,i.setItem("~~~","!"),i.removeItem("~~~")}catch(r){i=null}return t.mixin(n.prototype,{_prefix:function(e){return this.prefix+e},_ttlKey:function(e){return this._prefix(e)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=t.noop},_safeSet:function(e,t){try{this.ls.setItem(e,t)}catch(i){"QuotaExceededError"===i.name&&(this.clear(),this._noop())}},get:function(e){return this.isExpired(e)&&this.remove(e),l(this.ls.getItem(this._prefix(e)))},set:function(e,i,r){return t.isNumber(r)?this._safeSet(this._ttlKey(e),o(a()+r)):this.ls.removeItem(this._ttlKey(e)),this._safeSet(this._prefix(e),o(i))},remove:function(e){return this.ls.removeItem(this._ttlKey(e)),this.ls.removeItem(this._prefix(e)),this},clear:function(){var e,t=s(this.keyMatcher);for(e=t.length;e--;)this.remove(t[e]);return this},isExpired:function(e){var i=l(this.ls.getItem(this._ttlKey(e)));return t.isNumber(i)&&a()>i?!0:!1}}),n}(),o=function(){"use strict";function l(e){e=e||{},this.cancelled=!1,this.lastReq=null,this._send=e.transport,this._get=e.limiter?e.limiter(this._get):this._get,this._cache=e.cache===!1?new n(0):o}var i=0,r={},a=6,o=new n(10);return l.setMaxPendingRequests=function(e){a=e},l.resetCache=function(){o.reset()},t.mixin(l.prototype,{_fingerprint:function(t){return t=t||{},t.url+t.type+e.param(t.data||{})},_get:function(e,t){function s(e){t(null,e),n._cache.set(o,e)}function u(){t(!0)}function c(){i--,delete r[o],n.onDeckRequestArgs&&(n._get.apply(n,n.onDeckRequestArgs),n.onDeckRequestArgs=null)}var o,l,n=this;o=this._fingerprint(e),this.cancelled||o!==this.lastReq||((l=r[o])?l.done(s).fail(u):a>i?(i++,r[o]=this._send(e).done(s).fail(u).always(c)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(i,r){var n,a;r=r||e.noop,i=t.isString(i)?{url:i}:i||{},a=this._fingerprint(i),this.cancelled=!1,this.lastReq=a,(n=this._cache.get(a))?r(null,n):this._get(i,r)},cancel:function(){this.cancelled=!0}}),l}(),l=window.SearchIndex=function(){"use strict";function n(i){i=i||{},i.datumTokenizer&&i.queryTokenizer||e.error("datumTokenizer and queryTokenizer are both required"),this.identify=i.identify||t.stringify,this.datumTokenizer=i.datumTokenizer,this.queryTokenizer=i.queryTokenizer,this.reset()}function a(e){return e=t.filter(e,function(e){return!!e}),e=t.map(e,function(e){return e.toLowerCase()})}function o(){var e={};return e[r]=[],e[i]={},e}function l(e){for(var t={},i=[],r=0,n=e.length;n>r;r++)t[e[r]]||(t[e[r]]=!0,i.push(e[r]));return i}function s(e,t){var i=0,r=0,n=[];e=e.sort(),t=t.sort();for(var a=e.length,o=t.length;a>i&&o>r;)e[i]<t[r]?i++:e[i]>t[r]?r++:(n.push(e[i]),i++,r++);return n}var i="c",r="i";return t.mixin(n.prototype,{bootstrap:function(e){this.datums=e.datums,this.trie=e.trie},add:function(e){var n=this;e=t.isArray(e)?e:[e],t.each(e,function(e){var l,s;n.datums[l=n.identify(e)]=e,s=a(n.datumTokenizer(e)),t.each(s,function(e){var t,a,s;for(t=n.trie,a=e.split("");s=a.shift();)t=t[i][s]||(t[i][s]=o()),t[r].push(l)})})},get:function(e){var i=this;return t.map(e,function(e){return i.datums[e]})},search:function(e){var o,u,n=this;return o=a(this.queryTokenizer(e)),t.each(o,function(e){var t,a,o,l;if(u&&0===u.length)return!1;for(t=n.trie,a=e.split("");t&&(o=a.shift());)t=t[i][o];return t&&0===a.length?(l=t[r].slice(0),void(u=u?s(u,l):l)):(u=[],!1)}),u?t.map(l(u),function(e){return n.datums[e]}):[]},all:function(){var e=[];for(var t in this.datums)e.push(this.datums[t]);return e},reset:function(){this.datums={},this.trie=o()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),n}(),s=function(){"use strict";function i(e){this.url=e.url,this.ttl=e.ttl,this.cache=e.cache,this.prepare=e.prepare,this.transform=e.transform,this.transport=e.transport,this.thumbprint=e.thumbprint,this.storage=new a(e.cacheKey)}var e;return e={data:"data",protocol:"protocol",thumbprint:"thumbprint"},t.mixin(i.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(t){this.cache&&(this.storage.set(e.data,t,this.ttl),this.storage.set(e.protocol,location.protocol,this.ttl),this.storage.set(e.thumbprint,this.thumbprint,this.ttl))},fromCache:function(){var i,t={};return this.cache?(t.data=this.storage.get(e.data),t.protocol=this.storage.get(e.protocol),t.thumbprint=this.storage.get(e.thumbprint),i=t.thumbprint!==this.thumbprint||t.protocol!==location.protocol,t.data&&!i?t.data:null):null},fromNetwork:function(e){function r(){e(!0)}function n(i){e(null,t.transform(i))}var i,t=this;e&&(i=this.prepare(this._settings()),this.transport(i).fail(r).done(n))},clear:function(){return this.storage.clear(),this}}),i}(),u=function(){"use strict";function e(e){this.url=e.url,this.prepare=e.prepare,this.transform=e.transform,this.transport=new o({cache:e.cache,limiter:e.limiter,transport:e.transport})}return t.mixin(e.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(e,t){function n(e,r){t(e?[]:i.transform(r))}var r,i=this;if(t)return e=e||"",r=this.prepare(e,this._settings()),this.transport.get(r,n)},cancelLastRequest:function(){this.transport.cancel()}}),e}(),c=function(){"use strict";function r(r){var n;return r?(n={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:t.identity,transform:t.identity,transport:null},r=t.isString(r)?{url:r}:r,r=t.mixin(n,r),!r.url&&e.error("prefetch requires url to be set"),r.transform=r.filter||r.transform,r.cacheKey=r.cacheKey||r.url,r.thumbprint=i+r.thumbprint,r.transport=r.transport?l(r.transport):e.ajax,r):null}function n(i){var r;if(i)return r={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:t.identity,transport:null},i=t.isString(i)?{url:i}:i,i=t.mixin(r,i),!i.url&&e.error("remote requires url to be set"),i.transform=i.filter||i.transform,i.prepare=a(i),i.limiter=o(i),i.transport=i.transport?l(i.transport):e.ajax,delete i.replace,delete i.wildcard,delete i.rateLimitBy,delete i.rateLimitWait,i}function a(e){function n(e,t){return t.url=i(t.url,e),t}function a(e,t){return t.url=t.url.replace(r,encodeURIComponent(e)),t}function o(e,t){return t}var t,i,r;return t=e.prepare,i=e.replace,r=e.wildcard,t?t:t=i?n:e.wildcard?a:o}function o(e){function a(e){return function(i){return t.debounce(i,e)}}function o(e){return function(i){return t.throttle(i,e)}}var i,r,n;return i=e.limiter,r=e.rateLimitBy,n=e.rateLimitWait,i||(i=/^throttle$/i.test(r)?o(n):a(n)),i}function l(i){return function(r){function a(e){t.defer(function(){n.resolve(e)})}function o(e){t.defer(function(){n.reject(e)})}var n=e.Deferred();return i(r,a,o),n}}return function(i){var a,o;return a={initialize:!0,identify:t.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},i=t.mixin(a,i||{}),!i.datumTokenizer&&e.error("datumTokenizer is required"),!i.queryTokenizer&&e.error("queryTokenizer is required"),o=i.sorter,i.sorter=o?function(e){return e.sort(o)}:t.identity,i.local=t.isFunction(i.local)?i.local():i.local,i.prefetch=r(i.prefetch),i.remote=n(i.remote),i}}(),f=function(){"use strict";function n(e){e=c(e),this.sorter=e.sorter,this.identify=e.identify,this.sufficient=e.sufficient,this.local=e.local,this.remote=e.remote?new u(e.remote):null,this.prefetch=e.prefetch?new s(e.prefetch):null,this.index=new l({identify:this.identify,datumTokenizer:e.datumTokenizer,queryTokenizer:e.queryTokenizer}),e.initialize!==!1&&this.initialize()}var i;return i=window&&window.Bloodhound,n.noConflict=function(){return window&&(window.Bloodhound=i),n},n.tokenizers=r,t.mixin(n.prototype,{__ttAdapter:function(){function t(t,i,r){return e.search(t,i,r)}function i(t,i){return e.search(t,i)}var e=this;return this.remote?t:i},_loadPrefetch:function(){function n(e,r){return e?i.reject():(t.add(r),t.prefetch.store(t.index.serialize()),void i.resolve())}var i,r,t=this;return i=e.Deferred(),this.prefetch?(r=this.prefetch.fromCache())?(this.index.bootstrap(r),i.resolve()):this.prefetch.fromNetwork(n):i.resolve(),i.promise()},_initialize:function(){function i(){e.add(e.local)}var e=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(i),this.initPromise},initialize:function(e){return!this.initPromise||e?this._initialize():this.initPromise},add:function(e){return this.index.add(e),this},get:function(e){return e=t.isArray(e)?e:[].slice.call(arguments),this.index.get(e)},search:function(e,i,r){function o(e){var i=[];t.each(e,function(e){!t.some(a,function(t){return n.identify(e)===n.identify(t)})&&i.push(e)}),r&&r(i)}var a,n=this;return a=this.sorter(this.index.search(e)),i(this.remote?a.slice():a),this.remote&&a.length<this.sufficient?this.remote.get(e,o):this.remote&&this.remote.cancelLastRequest(),this},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return o.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),n}();return f});
